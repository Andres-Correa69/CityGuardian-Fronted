<div class="container mt-4">
  <!-- Tabla de Reportes -->
  <div class="row mb-4">
    <div class="col-12 d-flex justify-content-between align-items-center">
      <h2>Reportes</h2>
      <button class="btn btn-primary" (click)="openCreateReportModal()">
        <i class="bi bi-plus-circle"></i> Crear Reporte
      </button>
    </div>
    <div class="col-12">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Título</th>
            <th>Descripción</th>
            <th>Estado</th>
            <th>Ubicación</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let report of reports">
            <td>{{ report.title }}</td>
            <td>{{ report.description }}</td>
            <td>
              <a (click)="verDetalle(report)" class="text-primary text-decoration-underline" style="cursor: pointer;">
                Ver detalle
              </a>
            </td>
            <td>{{ report.status }}</td>
            <td>{{ report.location?.latitude }} {{report.location == null || report.location.latitude == '' ? '' : ','
              }} {{ report.location?.longitude }}
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Template del Modal de Creación -->
  <ng-template #createReportTemplate>
    <form (ngSubmit)="createReport()">
      <div class="mb-3">
        <label class="form-label">Título:</label>
        <input type="text" class="form-control" [(ngModel)]="newReport.title" name="title" required>
      </div>

      <div class="mb-3">
        <label class="form-label">Descripción:</label>
        <textarea class="form-control" [(ngModel)]="newReport.description" name="description" required></textarea>
      </div>

      <select class="form-select mb-3" [(ngModel)]="newReport.categoryId" name="categoryId" required>
        <option value="">Selecciona una categoría</option>
        <option *ngFor="let category of categories" [value]="category.id">{{ category.name }}</option>
      </select>

      <div class="mb-3">
        <label class="form-label">Imágenes:</label>
        <input type="file" class="form-control" (change)="onFileSelected($event)" multiple>
      </div>

      <div class="mb-3">
        <label class="form-label">Ubicación:</label>
        <div id="mapa"></div>
      </div>

      <div class="d-flex justify-content-end gap-2">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Cancelar</button>
        <button type="submit" class="btn btn-primary">Crear Reporte</button>
      </div>
    </form>
  </ng-template>
</div>